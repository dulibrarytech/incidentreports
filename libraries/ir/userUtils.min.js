userUtils=(function(j){var i="templates/partials/ir-form.html";var d="templates/partials/editUser.html";var h,f,c,e,l,k,m,a,n,o,b,g;h=function(){var p=j("#incident-report").serialize();if(sendEmailNotifications){p+="&sendNotifications=true"}requestObj={type:"POST",url:service_url+_submitIRForm,dataType:"json",data:p,success:function(q){if(q.status=="success"){if(q.emailStatus=="success"){systemUtils.sendMessage("Incident Report submitted.")}else{if(q.emailStatus=="disabled"){systemUtils.sendMessage("Incident Report submitted.");console.log("Email notifications are disabled")}else{if(q.emailStatus=="error"){systemUtils.sendMessage("Incident Report submitted, error sending email notifications");console.log("Server reports email error, email notifications not sent")}}}j("#incident-report").trigger("reset")}else{console.log("Server reports error when writing to the database");systemUtils.sendMessage("Server error: Please contact Systems support")}},error:function(q,s,r){console.log("Status: "+s+" Message: "+r);systemUtils.sendMessage("Server error: Please contact Systems support")}};systemUtils.doAjax(requestObj)};f=function(){if(systemUtils.validateLocalSession()){var p=j("#incident-report").serialize();var q=irUtils.getCurrentReportID();requestObj={type:"POST",url:service_url+_editIR,dataType:"json",data:p+"&reportID="+q,success:function(r){if(r.status=="success"){systemUtils.sendMessage("Incident Report updated.");systemUtils.updateSessionToken(r.token);irUtils.loadDashboard()}else{console.log("Server reports error when writing to the database");systemUtils.sendMessage("Server error: Please contact Systems support")}},error:function(r,t,s){console.log("Status: "+t+" Message: "+s);systemUtils.sendMessage("Server error: Please contact Systems support")}};systemUtils.doAjax(requestObj)}};c=function(q){if(systemUtils.validateLocalSession()){var p=irUtils.getCachedReport(q);if(p==null){}if(typeof reportDetails!="undefined"){viewUtils.openModalView(i,p,reportDetails)}else{console.log("Error: loader object not found for template!")}}};e=function(r){if(systemUtils.validateLocalSession()){var q=irUtils.getCachedReport(r);if(q==null){}var p='<div id="full-narrative-view"><p>'+q.OffenseNarrative+"</p></div>";viewUtils.openModalView(p)}};l=function(r){if(systemUtils.validateLocalSession()){var q=[];q.username=j("td#username-"+r).text();q.email=j("td#email-"+r).text();q.admin=j("td#admin-"+r).text();q.sendType=j("td#sendType-"+r).text();q.userID=r;if(q.userID==SID){var p=irUtils.getUserProfile();if(p.userID==SID){viewUtils.openModalView(d,q,editUser)}else{console.log("Only the superuser can edit this profile")}}else{viewUtils.openModalView(d,q,editUser)}}};a=function(){if(systemUtils.validateLocalSession()){var p=j("form#edit-user-data").attr("data-internalid");var q=j("#edit-user-data").serialize()+"&userid="+p;requestObj={type:"PUT",url:service_url+_editUserData,dataType:"json",data:q,success:function(r){if(r.status=="success"){systemUtils.sendMessage("User data updated successfully.");systemUtils.updateSessionToken(r.token)}else{console.log("Server reports error when writing to the database");systemUtils.sendMessage("Server error: Please contact Systems support")}},error:function(r,t,s){console.log("Status: "+t+" Message: "+s);systemUtils.sendMessage("Server error: Please contact Systems support")}};systemUtils.doAjax(requestObj)}};k=function(p){if(systemUtils.validateLocalSession()){if(p!=SID&&confirm("Remove user?")){requestObj={type:"POST",url:service_url+_removeUserData,dataType:"json",data:{ID:p},success:function(q){if(q.status=="success"){systemUtils.updateSessionToken(q.token);location.reload()}else{console.log("Server reports database error");systemUtils.sendMessage("Server error: Please contact Systems support")}},error:function(q,s,r){console.log("Status: "+s+" Message: "+r);systemUtils.sendMessage("Server error: Please contact Systems support")}};systemUtils.doAjax(requestObj)}}};m=function(){viewUtils.openModalView(d,null,addUser)};n=function(){if(systemUtils.validateLocalSession()){var p=j("#edit-user-data").serialize();requestObj={type:"POST",url:service_url+_addUserData,dataType:"json",data:p,success:function(q){if(q.status=="success"){systemUtils.sendMessage("User added successfully.");systemUtils.updateSessionToken(q.token);viewUtils.killModal()}else{console.log("Server reports error writing to the database");systemUtils.sendMessage("Server error: Please contact Systems support")}},error:function(q,s,r){console.log("Status: "+s+" Message: "+r);systemUtils.sendMessage("Server error: Please contact Systems support")}};systemUtils.doAjax(requestObj)}};o=function(){if(systemUtils.validateLocalSession()){var p=j("#trackingNumber").val();if(p==""||isNaN(p)){j("#trackingNumber").val("Please enter a number")}else{if(p.length>5){j("#trackingNumber").val("Length exceeded")}else{requestObj={type:"GET",url:service_url+_searchByTrackNum,dataType:"json",data:"id="+p,success:function(q){if(q.status=="success"){systemUtils.updateSessionToken(q.token);irUtils.refreshReportsTable(q.data);j("#show-all-reports-link").show()}else{console.log("Server Error");systemUtils.sendMessage("Server error: Please contact Systems support")}},error:function(q,s,r){console.log("Status: "+s+" Message: "+r);systemUtils.sendMessage("Server error: Please contact Systems support")}};systemUtils.doAjax(requestObj)}}}};g=function(){if(systemUtils.validateLocalSession()){var p={};p.offenseType=j("#offenseType").val();p.fromDate=j("#fromDate").val();p.toDate=j("#toDate").val();requestObj={type:"GET",url:service_url+_searchReports,dataType:"json",data:p,success:function(q){if(q.status=="success"){systemUtils.updateSessionToken(q.token);irUtils.refreshReportsTable(q.data);j("#show-all-reports-link").show()}else{console.log("Server Error");systemUtils.sendMessage("Server error: Please contact Systems support")}},error:function(q,s,r){console.log("Status: "+s+" Message: "+r);systemUtils.sendMessage("Server error: Please contact Systems support")}};systemUtils.doAjax(requestObj)}};return{submitIncidentReportForm:function(){h()},editIncidentReport:function(){f()},openDetailsDialogWindow:function(p){c(p)},openFullNarrativeWindow:function(p){e(p)},editUserData:function(p){l(p)},removeUserData:function(p){k(p)},addNewUser:function(){m()},submitUserUpdate:function(){a()},submitNewUserInfo:function(){n()},searchByTrackingNumber:function(){o()},resetReportsSearch:function(){j("#show-all-reports-link").hide();irUtils.clearReportsSearchForm();irUtils.refreshReportsTable()},searchByOffenseType:function(){g()}}}(jQuery));