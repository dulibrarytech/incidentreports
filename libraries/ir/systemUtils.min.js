systemUtils=(function(e){var l=true;var c=3000;var h,a,g,k,f,j,d,b,i,m;h=function(){viewUtils.initMenu();viewUtils.showAuthenticatedMenulinks(false)};a=function(o){var n=sessionStorage.getItem("user_token");o.beforeSend=function(p){p.setRequestHeader("x-access-token",n)};e(document).ajaxStart(function(){e("#wrapper").append('<div id="blockout"></div>');e.fancybox.showLoading()});e(document).ajaxStop(function(){e("#blockout").remove();e.fancybox.hideLoading()});e.ajax(o)};g=function(o,p,q){e("#content-wrapper").append("<div id='message-window'></div>");var n="<p><h4>"+o+"</h4></p>";e("#message-window").html(n);e(".submit-button").prop("disabled",true);if(typeof p=="undefined"||p==null){p=c}if(typeof q!="undefined"&&q==true){e("#wrapper").append('<div id="blackout"></div>')}if(p>0){e("#message-window").click(function(r){r.preventDefault();closeMessageDialog()});setTimeout(function(){closeMessageDialog()},p)}};closeMessageDialog=function(){e("#message-window").remove();e(".submit-button").prop("disabled",false);e("#blackout").remove()};k=function(){var n=false;requestObj={type:"POST",dataType:"text",url:service_url+"session/validate",async:false,success:function(o){if(o!="invalid"){sessionStorage.setItem("user_token",o);viewUtils.showAuthenticatedMenulinks(true,d());n=true}else{if(j()){var p="<h3>Session has expired, please <span class='hot-text' onclick='systemUtils.login()'>login</span> again</h3>";g(p,-1,true);viewUtils.showAuthenticatedMenulinks(false)}else{e("#main").html("<h2>403 Unauthorized</h2>");viewUtils.setURL("error")}}},error:function(o,q,p){console.log("Status: "+q+" Message: "+p);g("Server error: Please contact Systems support")}};a(requestObj);return n};j=function(){return(sessionStorage.getItem("user_token")!=null)&&(irUtils.getIncidentReports()!=null)};d=function(){var n=false;var o=JSON.parse(sessionStorage.getItem("user_profile"));if(typeof o!="null"){n=(o.admin=="1")}return n};f=function(){var o=e("#login-uname").val();var p=e("#login-passwd").val();var n={username:o,password:p};requestObj={type:"POST",url:service_url+_submitLoginForm,dataType:"json",data:n,success:function(q){if(q.status=="success"){sessionStorage.setItem("user_token",q.token);sessionStorage.setItem("user_profile",JSON.stringify(q.profile));sessionStorage.setItem("current_report_id",0);viewUtils.showAuthenticatedMenulinks(true,d());loginView.close();irUtils.loadDashboard()}else{g("Incorrect username or password.  Please try again");loginView.reset()}},error:function(q,s,r){console.log("Status: "+s+" Message: "+r);g("Server error: Please contact Systems support")}};a(requestObj)};b=function(n){sessionStorage.setItem("user_token",n)};m=function(){sessionStorage.removeItem("user_token");sessionStorage.removeItem("user_profile");irUtils.removeUserSessionData();viewUtils.showAuthenticatedMenulinks(false);viewUtils.killModal()};return{initIRApp:function(){h()},doAjax:function(n){a(n)},sendMessage:function(n,o,p){g(n,o,p)},validateLocalSession:function(){return k()},submitLoginForm:function(){f()},isValidSession:function(){return j()},isAdminUser:function(){return d()},updateSessionToken:function(n){b(n)},login:function(){m();closeMessageDialog();viewUtils.renderTemplate("login")},logout:function(){m()}}}(jQuery));