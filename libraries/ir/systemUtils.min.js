systemUtils=function(e){var s,t,o,n,i,r,a,u,l,c;return s=function(){viewUtils.initMenu(),viewUtils.showAuthenticatedMenulinks(!1)},t=function(s){var t=sessionStorage.getItem("user_token");t&&(s.beforeSend=function(e){e.setRequestHeader("x-access-token",t)}),e(document).ajaxStart((function(){e("#wrapper").append('<div id="blockout"></div>'),e.fancybox.showLoading()})),e(document).ajaxStop((function(){e("#blockout").remove(),e.fancybox.hideLoading()})),e.ajax(s)},o=function(s,t,o){e("#content-wrapper").append("<div id='message-window'></div>");var n="<p><h4>"+s+"</h4></p>";e("#message-window").html(n),e(".submit-button").prop("disabled",!0),void 0!==t&&null!=t||(t=3e3),void 0!==o&&1==o&&e("#wrapper").append('<div id="blackout"></div>'),t>0&&(e("#message-window").click((function(e){e.preventDefault(),closeMessageDialog()})),setTimeout((function(){closeMessageDialog()}),t))},closeMessageDialog=function(){e("#message-window").remove(),e(".submit-button").prop("disabled",!1),e("#blackout").remove()},n=function(){console.log("TEST validateLocalSession");var s=!1;return requestObj={type:"POST",dataType:"text",url:service_url+"session/validate",async:!1,success:function(t){if("invalid"!=t)sessionStorage.setItem("user_token",t),viewUtils.showAuthenticatedMenulinks(!0,a()),s=!0;else if(r()){o("<h3>Session has expired, please <span class='hot-text' onclick='systemUtils.login()'>login</span> again</h3>",-1,!0),viewUtils.showAuthenticatedMenulinks(!1)}else e("#main").html("<h2>403 Unauthorized</h2>"),viewUtils.setURL("error")},error:function(e,s,t){console.log("Status: "+s+" Message: "+t),o("Server error: Please contact Systems support")}},t(requestObj),s},r=function(){return null!=sessionStorage.getItem("user_token")&&null!=irUtils.getIncidentReports()},a=function(){var e=!1,s=JSON.parse(sessionStorage.getItem("user_profile"));return"null"!=typeof s&&(e="1"==s.admin),e},i=function(){var s=e("#login-uname").val(),n=e("#login-passwd").val();requestObj={type:"POST",url:service_url+_submitLoginForm,dataType:"json",data:{username:s,password:n},success:function(e){"success"==e.status?(sessionStorage.setItem("user_token",e.token),sessionStorage.setItem("user_profile",JSON.stringify(e.profile)),sessionStorage.setItem("current_report_id",0),viewUtils.showAuthenticatedMenulinks(!0,a()),loginView.close(),irUtils.loadDashboard()):(o("Incorrect username or password.  Please try again"),loginView.reset())},error:function(e,s,t){console.log("Status: "+s+" Message: "+t),o("Server error: Please contact Systems support")}},t(requestObj)},u=function(e){sessionStorage.setItem("user_token",e)},l=function(e){if(null!=e){let s={type:"GET",url:service_url+_validateTokenString,dataType:"json",data:{token:e},success:function(e){"success"==e.status?(sessionStorage.setItem("user_token",e.token),sessionStorage.setItem("user_profile",JSON.stringify(e.profile)),sessionStorage.setItem("current_report_id",0),viewUtils.showAuthenticatedMenulinks(!0,a()),irUtils.loadDashboard()):(console.log("Login error:",e.error),systemUtils.sendMessage("Server error: Please contact Systems support"))},error:function(e,s,t){console.log("Status: "+s+" Message: "+t),systemUtils.sendMessage("Server error: Please contact Systems support")}};t(s)}else window.location.replace("/")},c=function(){sessionStorage.removeItem("user_token"),sessionStorage.removeItem("user_profile"),irUtils.removeUserSessionData(),viewUtils.showAuthenticatedMenulinks(!1),viewUtils.killModal(),window.location.replace(ssoLogoutUrl)},{initIRApp:function(){s()},doAjax:function(e){t(e)},sendMessage:function(e,s,t){o(e,s,t)},validateLocalSession:function(){return n()},submitLoginForm:function(){i()},isValidSession:function(){return r()},isAdminUser:function(){return a()},updateSessionToken:function(e){u(e)},login:function(e=null){l(e)},logout:function(){c()}}}(jQuery);
